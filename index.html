<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Morning Buddy Pro ğŸ’•</title>

    <!-- Prevent Cache (Fixes undefined supa issue) -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css?v=3" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#ff9aa5" />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Lottie Animation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.5/lottie.min.js"></script>

    <!-- Supabase Client (Correct Script!) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js?v=3"></script>
</head>

<body>

    <!-- Background -->
    <div class="bg"></div>

    <!-- Floating Hearts + Butterflies -->
    <div class="float heart h1">ğŸ’•</div>
    <div class="float heart h2">ğŸ’–</div>
    <div class="float heart h3">ğŸ’“</div>
    <div class="float butterfly b1">ğŸ¦‹</div>
    <div class="float butterfly b2">ğŸ¦‹</div>

    <div class="app">

        <!-- Header -->
        <header class="header">
            <h1 class="app-title">Morning Buddy ğŸŒ¸</h1>
            <p class="tag">A cute wake-up world just for her ğŸ’•</p>
        </header>

        <!-- HOME SCREEN -->
        <section id="screen-home" class="screen active-screen">
            <div class="card mascot-card">
                <div class="mascot-avatar">ğŸ˜Š</div>
                <div id="mascotMessage" class="mascot-message">
                    Good morning! I'm proud of you ğŸ’•
                </div>
            </div>

            <div class="card">
                <h2>ğŸ’ Today's Vibe</h2>
                <p id="goalStatus">Your Goal: -- | Her Goal: --</p>
                <p id="homeStreakSummary">
                    No streak yetâ€¦ your first morning will already be special ğŸ’–
                </p>
            </div>

            <div class="card">
                <h2>ğŸ˜… Cute Message</h2>
                <button onclick="sendMessage()" class="btn big">Send a smile ğŸ’Œ</button>
                <div id="messageBox" class="message-box"></div>
            </div>
        </section>

        <!-- GOALS -->
        <section id="screen-goals" class="screen">
            <div class="card">
                <h2>ğŸ¯ Wake-Up Goals</h2>
                <label>Your goal:</label>
                <input id="myGoal" type="time" />
                <label>Her goal:</label>
                <input id="friendGoal" type="time" />
                <button onclick="saveGoals()" class="btn neon">Save Goals ğŸ’•</button>
            </div>
        </section>

        <!-- ALARM -->
        <section id="screen-rituals" class="screen">
            <div class="card">
                <h2>â° Cute Alarm</h2>
                <input id="alarmTime" type="time" />
                <p id="alarmSavedText"></p>
                <button onclick="saveAlarmTime()" class="btn neon">Save Alarm ğŸ’—</button>
                <button onclick="stopAlarm()" class="btn stop">Stop Alarm âŒ</button>
            </div>
        </section>

        <!-- STUDY -->
        <section id="screen-study" class="screen">
            <div class="card">
                <h2>ğŸ“š Study Log</h2>

                <label>You studied (hours):</label>
                <input id="myStudyInput" type="number" step="0.1" min="0" />
                <button onclick="saveMyStudy()" class="btn neon">Save</button>

                <label>She studied (hours):</label>
                <input id="friendStudyInput" type="number" step="0.1" min="0" />
                <button onclick="saveFriendStudy()" class="btn neon">Save</button>

                <p id="studySummaryText"></p>

                <canvas id="studyChart" height="120"></canvas>
            </div>
        </section>

        <!-- PROGRESS -->
        <section id="screen-progress" class="screen">
            <div class="card">
                <h2>ğŸ“… Monthly Calendar</h2>
                <h3 id="calendarHeader"></h3>
                <div id="calendarGrid" class="calendar-grid"></div>
            </div>

            <div class="card">
                <h2>ğŸ“ˆ Wake-Up Streak Chart</h2>
                <canvas id="progressChart" height="120"></canvas>
            </div>
        </section>

        <!-- REWARDS -->
        <section id="screen-rewards" class="screen">
            <div class="card">
                <h2>ğŸ Reward Badges</h2>
                <div id="badgeList" class="badge-list"></div>
            </div>

            <div class="card">
                <button onclick="resetStreaks()" class="btn stop">Reset Everything âŒ</button>
            </div>
        </section>

        <!-- Navigation Tabs -->
        <nav class="tabs">
            <button class="tab-btn active" onclick="showScreen('home', this)">ğŸ¡ Home</button>
            <button class="tab-btn" onclick="showScreen('goals', this)">ğŸ¯ Goals</button>
            <button class="tab-btn" onclick="showScreen('rituals', this)">â° Rituals</button>
            <button class="tab-btn" onclick="showScreen('study', this)">ğŸ“˜ Study</button>
            <button class="tab-btn" onclick="showScreen('progress', this)">ğŸ“ˆ Progress</button>
            <button class="tab-btn" onclick="showScreen('rewards', this)">ğŸ Rewards</button>
        </nav>
    </div>

    <!-- Reset Modal -->
    <div id="resetModal" class="modal">
        <div class="modal-content">
            <p>This will clear all your streaks and study logs ğŸ’”</p>
            <div class="modal-buttons">
                <button onclick="confirmReset()" class="btn neon">Yes, reset ğŸ’</button>
                <button onclick="closeResetModal()" class="btn stop">No, keep it ğŸ’—</button>
            </div>
        </div>
    </div>

    <!-- Main App Script -->
    <script src="script.js?v=3"></script>

    <!-- Service Worker -->
    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("sw.js");
        }
    </script>

</body>
</html>
